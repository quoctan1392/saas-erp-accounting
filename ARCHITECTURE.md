# Kiáº¿n TrÃºc Há»‡ Thá»‘ng - System Architecture

## ğŸ—ï¸ Tá»•ng Quan Kiáº¿n TrÃºc (Architecture Overview)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          CLIENT LAYER                                â”‚
â”‚  Web Browser / Mobile App / API Client                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚ HTTPS
                             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       LOAD BALANCER                                  â”‚
â”‚                    (Future: Nginx/Kong)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                                         â”‚
        â†“                                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   AUTH SERVICE       â”‚              â”‚   TENANT SERVICE     â”‚
â”‚   Port: 3001         â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚   Port: 3002         â”‚
â”‚                      â”‚   JWT Token  â”‚                      â”‚
â”‚  â€¢ User Registration â”‚  Validation  â”‚  â€¢ Tenant CRUD       â”‚
â”‚  â€¢ Login/Logout      â”‚              â”‚  â€¢ Subscriptions     â”‚
â”‚  â€¢ JWT Auth          â”‚              â”‚  â€¢ Plan Management   â”‚
â”‚  â€¢ Google OAuth      â”‚              â”‚  â€¢ Features Toggle   â”‚
â”‚  â€¢ User Management   â”‚              â”‚                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                                     â”‚
           â”‚                                     â”‚
           â†“                                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PostgreSQL          â”‚              â”‚  PostgreSQL          â”‚
â”‚  Database: auth_db   â”‚              â”‚  Database: tenant_db â”‚
â”‚                      â”‚              â”‚                      â”‚
â”‚  Tables:             â”‚              â”‚  Tables:             â”‚
â”‚  â€¢ users             â”‚              â”‚  â€¢ tenants           â”‚
â”‚                      â”‚              â”‚  â€¢ subscriptions     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                                         â”‚
        â†“                                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      REDIS           â”‚              â”‚     RABBITMQ         â”‚
â”‚   Port: 6379         â”‚              â”‚  Port: 5672 / 15672  â”‚
â”‚                      â”‚              â”‚                      â”‚
â”‚  â€¢ Caching           â”‚              â”‚  â€¢ Message Queue     â”‚
â”‚  â€¢ Session Store     â”‚              â”‚  â€¢ Event Bus         â”‚
â”‚  â€¢ Rate Limiting     â”‚              â”‚  â€¢ Async Tasks       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ Luá»“ng Xá»­ LÃ½ (Processing Flow)

### 1. Authentication Flow (Luá»“ng ÄÄƒng Nháº­p)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   1. POST /auth/register    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Client  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ Auth Service â”‚
â”‚         â”‚                               â”‚              â”‚
â”‚         â”‚   2. Validate & Hash Password â”‚              â”‚
â”‚         â”‚   â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚              â”‚
â”‚         â”‚                               â”‚              â”‚
â”‚         â”‚   3. Store User               â”‚              â”‚
â”‚         â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚ PostgreSQL   â”‚
â”‚         â”‚                               â”‚  (auth_db)   â”‚
â”‚         â”‚   4. Return Success           â”‚              â”‚
â”‚         â”‚   â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚              â”‚
â”‚         â”‚                               â”‚              â”‚
â”‚         â”‚   5. POST /auth/login         â”‚              â”‚
â”‚         â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚              â”‚
â”‚         â”‚                               â”‚              â”‚
â”‚         â”‚   6. Validate Credentials     â”‚              â”‚
â”‚         â”‚   â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚              â”‚
â”‚         â”‚                               â”‚              â”‚
â”‚         â”‚   7. Generate JWT Tokens      â”‚              â”‚
â”‚         â”‚   â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚              â”‚
â”‚         â”‚                               â”‚              â”‚
â”‚         â”‚   8. accessToken              â”‚              â”‚
â”‚         â”‚      + refreshToken           â”‚              â”‚
â”‚         â”‚   â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. Tenant Creation Flow (Luá»“ng Táº¡o Tenant)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   1. POST /tenants           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Client  â”‚      + Bearer Token           â”‚ Tenant Serviceâ”‚
â”‚         â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚               â”‚
â”‚         â”‚                               â”‚               â”‚
â”‚         â”‚   2. Verify JWT               â”‚               â”‚
â”‚         â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚ Auth Service  â”‚
â”‚         â”‚      (Internal Call)          â”‚  (Validation) â”‚
â”‚         â”‚   â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚               â”‚
â”‚         â”‚                               â”‚               â”‚
â”‚         â”‚   3. Generate Slug            â”‚               â”‚
â”‚         â”‚      Check Uniqueness         â”‚               â”‚
â”‚         â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚ PostgreSQL    â”‚
â”‚         â”‚                               â”‚  (tenant_db)  â”‚
â”‚         â”‚   4. Create Tenant            â”‚               â”‚
â”‚         â”‚      Set Trial (14 days)      â”‚               â”‚
â”‚         â”‚      Assign Features          â”‚               â”‚
â”‚         â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚               â”‚
â”‚         â”‚                               â”‚               â”‚
â”‚         â”‚   5. Return Tenant Object     â”‚               â”‚
â”‚         â”‚   â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“Š Chi Tiáº¿t Services (Service Details)

### Auth Service (Dá»‹ch Vá»¥ XÃ¡c Thá»±c)

```
auth-service/
â”œâ”€â”€ Endpoints:
â”‚   â”œâ”€â”€ POST   /api/v1/auth/register     âœ… ÄÄƒng kÃ½
â”‚   â”œâ”€â”€ POST   /api/v1/auth/login        âœ… ÄÄƒng nháº­p
â”‚   â”œâ”€â”€ GET    /api/v1/auth/google       âœ… Google OAuth
â”‚   â”œâ”€â”€ POST   /api/v1/auth/refresh      âœ… LÃ m má»›i token
â”‚   â”œâ”€â”€ POST   /api/v1/auth/logout       âœ… ÄÄƒng xuáº¥t
â”‚   â”œâ”€â”€ GET    /api/v1/auth/me           âœ… ThÃ´ng tin user
â”‚   â””â”€â”€ GET    /api/v1/health            âœ… Health check
â”‚
â”œâ”€â”€ Features:
â”‚   â”œâ”€â”€ âœ… JWT Authentication
â”‚   â”œâ”€â”€ âœ… Refresh Token Rotation
â”‚   â”œâ”€â”€ âœ… Google OAuth 2.0
â”‚   â”œâ”€â”€ âœ… Password Hashing (bcrypt)
â”‚   â”œâ”€â”€ âœ… Role-Based Access Control
â”‚   â””â”€â”€ âœ… Email Verification Ready
â”‚
â”œâ”€â”€ Database (auth_db):
â”‚   â””â”€â”€ users
â”‚       â”œâ”€â”€ id (UUID)
â”‚       â”œâ”€â”€ email (unique)
â”‚       â”œâ”€â”€ password (hashed)
â”‚       â”œâ”€â”€ role (enum: 6 roles)
â”‚       â”œâ”€â”€ provider (local/google)
â”‚       â””â”€â”€ timestamps
â”‚
â””â”€â”€ Security:
    â”œâ”€â”€ JWT Secret Key
    â”œâ”€â”€ Refresh Token Storage
    â”œâ”€â”€ CORS Protection
    â””â”€â”€ Input Validation
```

### Tenant Service (Dá»‹ch Vá»¥ Quáº£n LÃ½ Tenant)

```
tenant-service/
â”œâ”€â”€ Endpoints:
â”‚   â”œâ”€â”€ POST   /api/v1/tenants                  âœ… Táº¡o tenant
â”‚   â”œâ”€â”€ GET    /api/v1/tenants                  âœ… Danh sÃ¡ch
â”‚   â”œâ”€â”€ GET    /api/v1/tenants/my-tenants       âœ… Tenant cá»§a tÃ´i
â”‚   â”œâ”€â”€ GET    /api/v1/tenants/:id              âœ… Chi tiáº¿t
â”‚   â”œâ”€â”€ PATCH  /api/v1/tenants/:id              âœ… Cáº­p nháº­t
â”‚   â”œâ”€â”€ PATCH  /api/v1/tenants/:id/status       âœ… Äá»•i tráº¡ng thÃ¡i
â”‚   â”œâ”€â”€ PATCH  /api/v1/tenants/:id/upgrade      âœ… NÃ¢ng cáº¥p gÃ³i
â”‚   â”œâ”€â”€ POST   /api/v1/subscriptions            âœ… Táº¡o subscription
â”‚   â””â”€â”€ GET    /api/v1/health                   âœ… Health check
â”‚
â”œâ”€â”€ Features:
â”‚   â”œâ”€â”€ âœ… Multi-Tenant Management
â”‚   â”œâ”€â”€ âœ… 4 Pricing Plans
â”‚   â”œâ”€â”€ âœ… Trial Period (14 days)
â”‚   â”œâ”€â”€ âœ… User Limits per Plan
â”‚   â”œâ”€â”€ âœ… Feature Toggles
â”‚   â””â”€â”€ âœ… Subscription Management
â”‚
â”œâ”€â”€ Plans & Limits:
â”‚   â”œâ”€â”€ FREE:       5 users,    Basic features
â”‚   â”œâ”€â”€ STARTER:    20 users,   + Inventory
â”‚   â”œâ”€â”€ BUSINESS:   100 users,  + Multi-currency
â”‚   â””â”€â”€ ENTERPRISE: Unlimited,  + SSO, Custom
â”‚
â”œâ”€â”€ Database (tenant_db):
â”‚   â”œâ”€â”€ tenants
â”‚   â”‚   â”œâ”€â”€ id, name, slug
â”‚   â”‚   â”œâ”€â”€ status, plan
â”‚   â”‚   â”œâ”€â”€ ownerId
â”‚   â”‚   â”œâ”€â”€ maxUsers, currentUsers
â”‚   â”‚   â”œâ”€â”€ features (jsonb)
â”‚   â”‚   â””â”€â”€ timestamps
â”‚   â”‚
â”‚   â””â”€â”€ subscriptions
â”‚       â”œâ”€â”€ id, tenantId
â”‚       â”œâ”€â”€ plan, status
â”‚       â”œâ”€â”€ billingCycle
â”‚       â”œâ”€â”€ amount
â”‚       â””â”€â”€ dates
â”‚
â””â”€â”€ Business Logic:
    â”œâ”€â”€ Slug Generation (auto)
    â”œâ”€â”€ Trial Management
    â”œâ”€â”€ Plan Upgrades/Downgrades
    â””â”€â”€ User Limit Enforcement
```

## ğŸ—„ï¸ Database Architecture (Kiáº¿n TrÃºc Database)

```
PostgreSQL Container (erp-postgres)
â”‚
â”œâ”€â”€ auth_db (Auth Service) âœ…
â”‚   â””â”€â”€ users
â”‚       â”œâ”€â”€ Primary Key: id (UUID)
â”‚       â”œâ”€â”€ Unique: email
â”‚       â”œâ”€â”€ Indexed: email, role
â”‚       â””â”€â”€ Relations: None (isolated)
â”‚
â”œâ”€â”€ tenant_db (Tenant Service) âœ…
â”‚   â”œâ”€â”€ tenants
â”‚   â”‚   â”œâ”€â”€ Primary Key: id (UUID)
â”‚   â”‚   â”œâ”€â”€ Unique: name, slug
â”‚   â”‚   â”œâ”€â”€ Indexed: slug, status, ownerId
â”‚   â”‚   â””â”€â”€ Relations: â†’ subscriptions
â”‚   â”‚
â”‚   â””â”€â”€ subscriptions
â”‚       â”œâ”€â”€ Primary Key: id (UUID)
â”‚       â”œâ”€â”€ Foreign Key: tenantId â†’ tenants(id)
â”‚       â”œâ”€â”€ Indexed: tenantId, status
â”‚       â””â”€â”€ Relations: â† tenant
â”‚
â”œâ”€â”€ accounting_db (Future) ğŸ“‹
â”œâ”€â”€ sales_db (Future) ğŸ“‹
â”œâ”€â”€ inventory_db (Future) ğŸ“‹
â”œâ”€â”€ purchase_db (Future) ğŸ“‹
â””â”€â”€ hr_db (Future) ğŸ“‹

Note: Má»—i service cÃ³ database riÃªng biá»‡t
      theo nguyÃªn táº¯c Microservices
```

## ğŸ” Security Layers (CÃ¡c Táº§ng Báº£o Máº­t)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Level 1: Network Layer                           â”‚
â”‚ â”œâ”€â”€ CORS Policy                                  â”‚
â”‚ â”œâ”€â”€ Rate Limiting (Redis)                        â”‚
â”‚ â””â”€â”€ HTTPS/TLS (Production)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Level 2: Authentication Layer                    â”‚
â”‚ â”œâ”€â”€ JWT Token Validation                         â”‚
â”‚ â”œâ”€â”€ Refresh Token Rotation                       â”‚
â”‚ â”œâ”€â”€ Token Expiration                             â”‚
â”‚ â””â”€â”€ OAuth 2.0 (Google)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Level 3: Authorization Layer                     â”‚
â”‚ â”œâ”€â”€ Role-Based Access Control (RBAC)             â”‚
â”‚ â”œâ”€â”€ Resource Ownership Check                     â”‚
â”‚ â””â”€â”€ Tenant Isolation                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Level 4: Data Layer                              â”‚
â”‚ â”œâ”€â”€ Password Hashing (bcrypt)                    â”‚
â”‚ â”œâ”€â”€ SQL Injection Protection (TypeORM)           â”‚
â”‚ â”œâ”€â”€ Input Validation (class-validator)           â”‚
â”‚ â””â”€â”€ Sensitive Data Masking                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸš€ Deployment Architecture (Kiáº¿n TrÃºc Triá»ƒn Khai)

### Development (Hiá»‡n Táº¡i)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Docker Compose                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ PostgreSQL                        â”‚  â”‚
â”‚  â”‚ Redis                             â”‚  â”‚
â”‚  â”‚ RabbitMQ                          â”‚  â”‚
â”‚  â”‚ Auth Service                      â”‚  â”‚
â”‚  â”‚ Tenant Service                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Production (TÆ°Æ¡ng Lai)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             Kubernetes Cluster                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Ingress Controller (Kong/Nginx)           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚               â”‚                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Services (Deployments + HPA)              â”‚  â”‚
â”‚  â”‚ â”œâ”€â”€ Auth Service (3 replicas)             â”‚  â”‚
â”‚  â”‚ â”œâ”€â”€ Tenant Service (3 replicas)           â”‚  â”‚
â”‚  â”‚ â”œâ”€â”€ Accounting Service                    â”‚  â”‚
â”‚  â”‚ â””â”€â”€ ...                                   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Managed Services                          â”‚  â”‚
â”‚  â”‚ â”œâ”€â”€ PostgreSQL (RDS/Cloud SQL)            â”‚  â”‚
â”‚  â”‚ â”œâ”€â”€ Redis (ElastiCache/MemoryStore)       â”‚  â”‚
â”‚  â”‚ â””â”€â”€ RabbitMQ (CloudAMQP)                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ˆ Scalability (Kháº£ NÄƒng Má»Ÿ Rá»™ng)

### Horizontal Scaling
```
Load Balancer
      â”‚
      â”œâ”€â–º Auth Service Instance 1
      â”œâ”€â–º Auth Service Instance 2
      â””â”€â–º Auth Service Instance 3
            â”‚
            â†“
      Redis (Session)
      PostgreSQL (Data)
```

### Database Scaling
```
Primary PostgreSQL
      â”œâ”€â–º Read Replica 1
      â”œâ”€â–º Read Replica 2
      â””â”€â–º Read Replica 3

Write â†’ Primary
Read  â†’ Replicas (Round Robin)
```

## ğŸ”„ Event Flow (Luá»“ng Sá»± Kiá»‡n)

```
Service A                RabbitMQ              Service B
    â”‚                        â”‚                     â”‚
    â”‚  1. Publish Event      â”‚                     â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                     â”‚
    â”‚    (order.created)     â”‚                     â”‚
    â”‚                        â”‚  2. Route to Queue  â”‚
    â”‚                        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
    â”‚                        â”‚                     â”‚
    â”‚                        â”‚  3. Consume Event   â”‚
    â”‚                        â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚                        â”‚                     â”‚
    â”‚                        â”‚  4. Process         â”‚
    â”‚                        â”‚                     â”œâ”€â–º Database
    â”‚                        â”‚                     â”‚
    â”‚                        â”‚  5. Publish Result  â”‚
    â”‚                        â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚  6. Consume Result     â”‚   (order.confirmed) â”‚
    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                     â”‚
    â”‚                        â”‚                     â”‚
```

## ğŸ“Š Monitoring & Logging (GiÃ¡m SÃ¡t - TÆ°Æ¡ng Lai)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Application Layer                 â”‚
â”‚  â”œâ”€â”€ Winston Logger                       â”‚
â”‚  â”œâ”€â”€ Request Logging                      â”‚
â”‚  â””â”€â”€ Error Tracking                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Logging Stack                     â”‚
â”‚  â”œâ”€â”€ Elasticsearch (Storage)              â”‚
â”‚  â”œâ”€â”€ Logstash (Processing)                â”‚
â”‚  â””â”€â”€ Kibana (Visualization)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Metrics & Monitoring              â”‚
â”‚  â”œâ”€â”€ Prometheus (Metrics)                 â”‚
â”‚  â”œâ”€â”€ Grafana (Dashboards)                 â”‚
â”‚  â””â”€â”€ AlertManager (Alerts)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**âœ… Há»‡ thá»‘ng Ä‘Ã£ sáºµn sÃ ng cho development!**
**âœ… System is ready for development!**
